<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stage 7: Container Extraction -- Defender Scan Pipeline</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a2e;--bg4:#22223a;
  --fg:#e0e0e8;--fg2:#a0a0b8;--fg3:#707088;
  --cyan:#00e5ff;--green:#39ff14;--purple:#b388ff;--orange:#ff9100;
  --red:#ff5252;--yellow:#ffd740;--pink:#ff80ab;
  --mono:'SF Mono','Fira Code','Cascadia Code','JetBrains Mono',Consolas,monospace;
  --sans:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,sans-serif;
  --slide-transition:0.5s cubic-bezier(0.4,0,0.2,1);
}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--fg);font-family:var(--sans)}
body{display:flex;flex-direction:column}
#progress{position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--cyan),var(--purple));z-index:100;transition:width 0.4s ease}
#slide-counter{position:fixed;bottom:18px;right:24px;font-family:var(--mono);font-size:13px;color:var(--fg3);z-index:100;user-select:none}
#deck{flex:1;position:relative;overflow:hidden}
.slide{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:60px 80px;opacity:0;transform:translateX(60px);transition:opacity var(--slide-transition),transform var(--slide-transition);pointer-events:none}
.slide.active{opacity:1;transform:translateX(0);pointer-events:auto}
.slide.prev{opacity:0;transform:translateX(-60px)}
.slide-inner{width:100%;max-width:1600px;height:100%;display:flex;flex-direction:column;justify-content:center}
h1{font-size:clamp(2rem,4.5vw,4rem);font-weight:800;line-height:1.1;letter-spacing:-0.02em}
h2{font-size:clamp(1.5rem,3vw,2.8rem);font-weight:700;line-height:1.2;letter-spacing:-0.01em;margin-bottom:0.6em}
h3{font-size:clamp(1rem,1.8vw,1.5rem);font-weight:600;margin-bottom:0.4em}
p,.desc{font-size:clamp(0.85rem,1.3vw,1.15rem);line-height:1.6;color:var(--fg2)}
code,.code{font-family:var(--mono);font-size:0.9em}
.mono{font-family:var(--mono)}
.glow-cyan{color:var(--cyan);text-shadow:0 0 30px rgba(0,229,255,0.4),0 0 60px rgba(0,229,255,0.15)}
.glow-green{color:var(--green);text-shadow:0 0 30px rgba(57,255,20,0.4)}
.glow-purple{color:var(--purple);text-shadow:0 0 30px rgba(179,136,255,0.4)}
.glow-orange{color:var(--orange);text-shadow:0 0 30px rgba(255,145,0,0.4)}
.glow-red{color:var(--red);text-shadow:0 0 30px rgba(255,82,82,0.4)}
.glow-yellow{color:var(--yellow);text-shadow:0 0 30px rgba(255,215,64,0.4)}
.split{display:grid;grid-template-columns:1fr 1fr;gap:40px;align-items:center;width:100%}
.split-60-40{display:grid;grid-template-columns:3fr 2fr;gap:40px;align-items:start;width:100%}
.center-col{display:flex;flex-direction:column;align-items:center;text-align:center}
.mt-1{margin-top:0.5em}.mt-2{margin-top:1em}.mt-3{margin-top:1.5em}.mb-1{margin-bottom:0.5em}.mb-2{margin-bottom:1em}
.stat-grid{display:grid;gap:14px}
.stat-grid-4{grid-template-columns:repeat(4,1fr)}
.stat-grid-3{grid-template-columns:repeat(3,1fr)}
.stat-grid-2x3{grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr)}
.stat-card{background:var(--bg3);border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:18px 16px;text-align:center;opacity:0;transform:translateY(20px);transition:opacity 0.5s ease,transform 0.5s ease}
.slide.active .stat-card{opacity:1;transform:translateY(0)}
.stat-card .num{font-size:clamp(1.2rem,2.2vw,2rem);font-weight:800;font-family:var(--mono);display:block}
.stat-card .label{font-size:clamp(0.65rem,0.9vw,0.85rem);color:var(--fg3);margin-top:4px;display:block}
.engine-bar{display:flex;align-items:center;gap:12px;background:var(--bg3);border-radius:8px;padding:10px 16px;border-left:4px solid var(--green);opacity:0;transform:translateX(-30px);transition:opacity 0.4s ease,transform 0.4s ease}
.slide.active .engine-bar{opacity:1;transform:translateX(0)}
.engine-bar .idx{font-family:var(--mono);font-size:0.75rem;color:var(--fg3);min-width:20px}
.engine-bar .name{font-weight:700;font-size:clamp(0.75rem,1.1vw,1rem);min-width:130px}
.engine-bar .detail{font-size:clamp(0.65rem,0.85vw,0.85rem);color:var(--fg2)}
.code-block{background:#0d0d18;border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:16px 20px;font-family:var(--mono);font-size:clamp(0.7rem,0.95vw,0.9rem);line-height:1.7;overflow-x:auto;color:var(--fg2);white-space:pre}
.code-block .kw{color:var(--purple)}.code-block .fn{color:var(--cyan)}.code-block .str{color:var(--green)}.code-block .num{color:var(--orange)}.code-block .cmt{color:var(--fg3);font-style:italic}
.flow-node{padding:8px 14px;border-radius:8px;font-size:clamp(0.6rem,0.75vw,0.75rem);font-weight:600;text-align:center;white-space:nowrap;opacity:0;transform:translateY(10px);transition:opacity 0.4s ease,transform 0.4s ease}
.slide.active .flow-node{opacity:1;transform:translateY(0)}
.flow-arrow{font-size:1.2em;color:var(--fg3);padding:0 4px;opacity:0;transition:opacity 0.4s ease}
.slide.active .flow-arrow{opacity:1}
.pipeline-track{position:relative;background:var(--bg3);border-radius:12px;padding:20px;overflow:hidden}
.pipeline-dot{position:absolute;width:12px;height:12px;border-radius:50%;background:var(--cyan);box-shadow:0 0 12px var(--cyan);top:50%;transform:translate(-50%,-50%);left:-20px;transition:left 3s linear}
.slide.active .pipeline-dot{left:calc(100% + 20px)}
@media(max-width:1200px){.slide{padding:40px}.split,.split-60-40{grid-template-columns:1fr;gap:24px}.stat-grid-4{grid-template-columns:repeat(2,1fr)}}
@media(max-width:768px){.slide{padding:24px}.stat-grid-3{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<div id="progress" style="width:0%"></div>
<div id="slide-counter"></div>
<div id="deck">

<!-- SLIDE 1: Title -->
<div class="slide active" data-slide="1">
<div class="slide-inner center-col" style="justify-content:center;gap:24px">
  <p class="mono" style="font-size:clamp(0.7rem,1vw,0.95rem);color:var(--fg3);letter-spacing:0.15em;text-transform:uppercase">Defender Scan Pipeline &mdash; Stage 7</p>
  <h1 class="glow-cyan">Container Extraction</h1>
  <h2 style="font-weight:400;font-size:clamp(1rem,2vw,1.6rem);color:var(--fg2)">Recursive unpacking of 70+ archive, document &amp; installer formats</h2>
  <div style="display:flex;gap:24px;margin-top:32px;flex-wrap:wrap;justify-content:center">
    <div class="stat-card" style="opacity:1;transform:none;min-width:120px"><span class="num glow-cyan" data-count="70">0</span><span class="label">nUFS Handlers</span></div>
    <div class="stat-card" style="opacity:1;transform:none;min-width:120px"><span class="num glow-green">25+</span><span class="label">Archive Formats</span></div>
    <div class="stat-card" style="opacity:1;transform:none;min-width:120px"><span class="num glow-purple">15</span><span class="label">PDF Config Flags</span></div>
    <div class="stat-card" style="opacity:1;transform:none;min-width:120px"><span class="num glow-orange">3</span><span class="label">AI/ML Formats</span></div>
  </div>
  <p class="mono mt-3" style="font-size:0.75rem;color:var(--fg3)">RTTI: .?AVIL_container@@ @ 0x10C7A778 &bull; mpengine.dll</p>
</div>
</div>

<!-- SLIDE 2: What Is Container Extraction? -->
<div class="slide" data-slide="2">
<div class="slide-inner">
  <h2 class="glow-cyan mb-1">What Is Container Extraction?</h2>
  <div class="split">
    <div>
      <p class="desc">Container extraction recognizes archive, document, and installer formats, then <strong>recursively extracts child objects</strong> so each one is scanned through the <strong>stages 2-13 (post-dispatch scan path)</strong>.</p>
      <p class="desc mt-2">This is one of three recursive feedback loops in the pipeline (alongside PE unpacking and script deobfuscation). A single malicious ZIP containing a macro-enabled Word doc can trigger hundreds of recursive scans.</p>
      <div class="code-block mt-2" style="font-size:0.78rem"><span class="cmt">// Key strings from mpengine.dll</span>
<span class="str">"containertype"</span>     @ <span class="num">0x109E7CA8</span>
<span class="str">"iscontainer"</span>       @ <span class="num">0x109E7EA0</span>
<span class="str">"isincontainer"</span>     @ <span class="num">0x109E7EBC</span>
<span class="str">"containertype=%s"</span>  @ <span class="num">0x10A54078</span>
<span class="str">"unpack:%s"</span>         @ <span class="num">0x10A4B010</span></div>
    </div>
    <div>
      <h3 style="color:var(--cyan);margin-bottom:12px">Recursive Architecture</h3>
      <div style="display:flex;flex-direction:column;gap:6px">
        <div class="flow-node" style="background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.3);padding:10px;transition-delay:0.1s;color:var(--cyan)">ZIP archive (containertype=zip)</div>
        <div style="text-align:center;color:var(--fg3);font-size:0.9em">&darr; extract children</div>
        <div class="flow-node" style="background:rgba(179,136,255,0.1);border:1px solid rgba(179,136,255,0.3);padding:10px;transition-delay:0.2s;color:var(--purple)">OLE2 document (.doc) &mdash; stages 2-13 rescan</div>
        <div style="text-align:center;color:var(--fg3);font-size:0.9em">&darr; extract VBA streams</div>
        <div class="flow-node" style="background:rgba(255,145,0,0.1);border:1px solid rgba(255,145,0,0.3);padding:10px;transition-delay:0.3s;color:var(--orange)">VBA Macro code &mdash; sent to NScript (Stage 8)</div>
        <div style="text-align:center;color:var(--fg3);font-size:0.9em">&darr; deobfuscate &rarr; detect</div>
        <div class="flow-node" style="background:rgba(255,82,82,0.15);border:2px solid rgba(255,82,82,0.4);padding:10px;transition-delay:0.4s;color:var(--red);font-weight:700">THREAT: Trojan:O97M/Downloader</div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 3: Format Categories -->
<div class="slide" data-slide="3">
<div class="slide-inner center-col">
  <h2 class="glow-green mb-2">70 nUFS Format Handlers</h2>
  <p class="desc mb-2">Discovered via string analysis: <code>nUFS_*</code> at addresses <code>0x10A14---</code> through <code>0x10B58---</code></p>
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;width:100%;max-width:1400px">
    <div class="stat-card" style="transition-delay:0.05s;border-left:3px solid var(--cyan);text-align:left;padding:14px">
      <span class="label" style="color:var(--cyan);font-weight:700;font-size:0.85rem">Archives (18)</span>
      <div style="font-size:0.72rem;color:var(--fg2);margin-top:6px;line-height:1.8">
        <code>nUFS_zip</code> <code>nUFS_rar</code> <code>nUFS_rar5</code> <code>nUFS_7z</code> <code>nUFS_cab</code> <code>nUFS_tar</code> <code>nUFS_cpio</code> <code>nUFS_ar</code> <code>nUFS_arj</code> <code>nUFS_arc</code> <code>nUFS_ace</code> <code>nUFS_zoo</code> <code>nUFS_sit</code> <code>nUFS_lh</code> <code>nUFS_bga</code> <code>nUFS_quantum</code> <code>nUFS_xar</code>
      </div>
    </div>
    <div class="stat-card" style="transition-delay:0.1s;border-left:3px solid var(--green);text-align:left;padding:14px">
      <span class="label" style="color:var(--green);font-weight:700;font-size:0.85rem">Documents (5)</span>
      <div style="font-size:0.72rem;color:var(--fg2);margin-top:6px;line-height:1.8">
        <code>nUFS_ole2</code> <code>nUFS_pdf</code> <code>nUFS_rtfn</code> <code>nUFS_mof</code> <code>nUFS_html</code>
      </div>
      <span class="label mt-1" style="color:var(--green);font-weight:700;font-size:0.85rem">Email (7)</span>
      <div style="font-size:0.72rem;color:var(--fg2);margin-top:6px;line-height:1.8">
        <code>nUFS_mimen</code> <code>nUFS_tnef</code> <code>nUFS_pst</code> <code>nUFS_mbx</code> <code>nUFS_dbx</code> <code>nUFS_binhex</code> <code>nUFS_emb1</code>
      </div>
    </div>
    <div class="stat-card" style="transition-delay:0.15s;border-left:3px solid var(--purple);text-align:left;padding:14px">
      <span class="label" style="color:var(--purple);font-weight:700;font-size:0.85rem">Installers (10)</span>
      <div style="font-size:0.72rem;color:var(--fg2);margin-top:6px;line-height:1.8">
        <code>nUFS_nsis</code> <code>nUFS_nsv1</code> <code>nUFS_inno</code> <code>nUFS_wise</code> <code>nUFS_ishld</code> <code>nUFS_ishldnew</code> <code>nUFS_instcrea</code> <code>nUFS_AutoIT</code> <code>nUFS_nbinder</code> <code>nUFS_c2rdat</code>
      </div>
    </div>
    <div class="stat-card" style="transition-delay:0.2s;border-left:3px solid var(--orange);text-align:left;padding:14px">
      <span class="label" style="color:var(--orange);font-weight:700;font-size:0.85rem">Disk Images (7)</span>
      <div style="font-size:0.72rem;color:var(--fg2);margin-top:6px;line-height:1.8">
        <code>nUFS_image</code> <code>nUFS_dmg</code> <code>nUFS_wim</code> <code>nUFS_udf</code> <code>nUFS_uefi</code> <code>nUFS_cf</code> <code>nUFS_fsd</code>
      </div>
      <span class="label mt-1" style="color:var(--yellow);font-weight:700;font-size:0.85rem">AI/ML Models (3)</span>
      <div style="font-size:0.72rem;color:var(--fg2);margin-top:6px;line-height:1.8">
        <code>nUFS_onnx</code> <code>nUFS_gguf</code> <code>nUFS_pickle</code>
      </div>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 4: Extraction Pipeline Flow -->
<div class="slide" data-slide="4">
<div class="slide-inner">
  <h2 class="glow-purple mb-1">Extraction Pipeline Flow</h2>
  <p class="desc mb-2">From magic-byte detection to recursive child scanning</p>
  <div class="pipeline-track">
    <div class="pipeline-dot"></div>
    <div style="display:flex;align-items:center;gap:0;flex-wrap:wrap;justify-content:center;position:relative;z-index:1">
      <div class="flow-node" style="background:var(--bg4);border:1px solid rgba(255,255,255,0.1);font-size:0.72rem;padding:8px 12px;transition-delay:0.05s;margin:4px">Magic Byte ID</div>
      <span class="flow-arrow" style="transition-delay:0.05s">&rarr;</span>
      <div class="flow-node" style="background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.3);font-size:0.72rem;padding:8px 12px;transition-delay:0.1s;margin:4px;color:var(--cyan)">Set containertype</div>
      <span class="flow-arrow" style="transition-delay:0.1s">&rarr;</span>
      <div class="flow-node" style="background:rgba(57,255,20,0.1);border:1px solid rgba(57,255,20,0.3);font-size:0.72rem;padding:8px 12px;transition-delay:0.15s;margin:4px;color:var(--green)">Depth Check</div>
      <span class="flow-arrow" style="transition-delay:0.15s">&rarr;</span>
      <div class="flow-node" style="background:rgba(179,136,255,0.1);border:1px solid rgba(179,136,255,0.3);font-size:0.72rem;padding:8px 12px;transition-delay:0.2s;margin:4px;color:var(--purple)">nUFS Dispatch</div>
      <span class="flow-arrow" style="transition-delay:0.2s">&rarr;</span>
      <div class="flow-node" style="background:rgba(255,145,0,0.1);border:1px solid rgba(255,145,0,0.3);font-size:0.72rem;padding:8px 12px;transition-delay:0.25s;margin:4px;color:var(--orange)">Enumerate Children</div>
      <span class="flow-arrow" style="transition-delay:0.25s">&rarr;</span>
      <div class="flow-node" style="background:rgba(57,255,20,0.15);border:2px solid rgba(57,255,20,0.5);font-size:0.72rem;padding:8px 14px;transition-delay:0.3s;margin:4px;color:var(--green);font-weight:700">Recursive Scan</div>
    </div>
  </div>
  <div class="split mt-2">
    <div class="code-block" style="font-size:0.75rem"><span class="cmt">// Magic byte detection examples</span>
<span class="str">PK\x03\x04</span>     &rarr; ZIP    <span class="cmt">// nUFS_zip @ 0x10A2FBA0</span>
<span class="str">\xD0\xCF\x11\xE0</span> &rarr; OLE2   <span class="cmt">// nUFS_ole2 @ 0x10A2B548</span>
<span class="str">%PDF-</span>         &rarr; PDF    <span class="cmt">// nUFS_pdf @ 0x10A28020</span>
<span class="str">Rar!\x1A\x07</span>  &rarr; RAR    <span class="cmt">// nUFS_rar @ 0x10A2CCA0</span>
<span class="str">7z\xBC\xAF</span>    &rarr; 7z     <span class="cmt">// nUFS_7z @ 0x10A153A8</span>
<span class="str">MSCF</span>          &rarr; CAB    <span class="cmt">// nUFS_cab @ 0x10A143B8</span>
<span class="str">{\rtf</span>         &rarr; RTF    <span class="cmt">// nUFS_rtfn @ 0x10A2786C</span>
<span class="str">ITSF</span>          &rarr; CHM    <span class="cmt">// nUFS_chm @ 0x10A2C8C8</span></div>
    <div class="code-block" style="font-size:0.75rem"><span class="cmt">// Recursive scan pseudocode</span>
<span class="kw">for</span> child <span class="kw">in</span> <span class="fn">handler.enumerate</span>() {
    <span class="kw">if</span> item_count >= max_items { <span class="kw">break</span>; }
    <span class="kw">if</span> elapsed > time_limit {
        <span class="cmt">// "Expensive container..."</span>
        <span class="cmt">//   @ 0x10A55050</span>
        <span class="fn">log_expensive</span>();
        <span class="kw">break</span>;
    }
    <span class="kw">let</span> vfo = <span class="fn">extract_to_vfo</span>(child);
    <span class="fn">set_attr</span>(vfo, <span class="str">"isincontainer"</span>);
    <span class="fn">queue_full_pipeline_scan</span>(vfo,
        depth + <span class="num">1</span>);  <span class="cmt">// Stages 2-13</span>
}</div>
  </div>
</div>
</div>

<!-- SLIDE 5: OLE2 & PDF Deep Parsing -->
<div class="slide" data-slide="5">
<div class="slide-inner">
  <h2 class="glow-orange mb-1">OLE2 &amp; PDF Deep Parsing</h2>
  <p class="desc mb-2">Specialized sub-processors for the most weaponized document formats</p>
  <div class="split">
    <div>
      <h3 style="color:var(--orange)">OLE2 Compound Documents</h3>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <div class="engine-bar" style="border-left-color:var(--orange);transition-delay:0.1s">
          <span class="name" style="color:var(--orange);min-width:160px">Word OLE File (.doc)</span>
          <span class="detail mono">@ 0x10A52970</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--orange);transition-delay:0.15s">
          <span class="name" style="color:var(--orange);min-width:160px">Excel OLE File (.xls)</span>
          <span class="detail mono">@ 0x10A5291C</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--orange);transition-delay:0.2s">
          <span class="name" style="color:var(--orange);min-width:160px">PowerPoint OLE (.ppt)</span>
          <span class="detail mono">@ 0x10A52934</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--orange);transition-delay:0.25s">
          <span class="name" style="color:var(--orange);min-width:160px">IlOLE File Generic</span>
          <span class="detail mono">@ 0x10A526A6</span>
        </div>
      </div>
      <p class="desc mt-2" style="font-size:0.8rem">Parses FAT/DIFAT sector chains, enumerates directory entries, extracts VBA macro streams for NScript processing.</p>
    </div>
    <div>
      <h3 style="color:var(--orange)">PDF Configuration Flags</h3>
      <div class="code-block" style="font-size:0.7rem"><span class="fn">PDF_ForceDeepScan</span>       @ <span class="num">0x10A27B7C</span>
<span class="fn">PDF_ScanAllStreams</span>       @ <span class="num">0x10A27BBC</span>
<span class="fn">PDF_DisableXFA</span>           @ <span class="num">0x10A27BDC</span>
<span class="fn">PDF_DisableXRefStreams</span>   @ <span class="num">0x10A27BEC</span>
<span class="fn">PDF_DisableObjectStreams</span> @ <span class="num">0x10A27C04</span>
<span class="fn">PDF_TrustLengthFields</span>   @ <span class="num">0x10A27C20</span>
<span class="fn">PDF_DecodeAllFilters</span>    @ <span class="num">0x10A27C88</span>
<span class="fn">PDF_DisableFilters</span>      @ <span class="num">0x10A27C74</span>
<span class="fn">PDF_NoOnAccessScanLimits</span>@ <span class="num">0x10A27C58</span>
<span class="fn">PDF_ScanSeparateScripts</span> @ <span class="num">0x10A27C38</span>
<span class="fn">PDF_IgnoreLengthField</span>   @ <span class="num">0x10A27B90</span>
<span class="fn">PDF_DisableDeepScan</span>     @ <span class="num">0x10A27BA8</span></div>
      <p class="desc mt-1" style="font-size:0.8rem">Per-object logging: <code>"PDF LOG object %d type %ls"</code> @ <code>0x10A27E20</code></p>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 6: Resource Limits & Performance -->
<div class="slide" data-slide="6">
<div class="slide-inner center-col">
  <h2 class="glow-red mb-1">Resource Limits &amp; Performance</h2>
  <p class="desc mb-2">DBVAR-controlled budgets prevent resource exhaustion from zip bombs and deep nesting</p>
  <div class="stat-grid stat-grid-4" style="width:100%;max-width:1200px">
    <div class="stat-card" style="transition-delay:0.05s"><span class="num glow-cyan">16</span><span class="label">Default Max Depth</span></div>
    <div class="stat-card" style="transition-delay:0.1s"><span class="num glow-green" data-count="10000">0</span><span class="label">Default Max Items</span></div>
    <div class="stat-card" style="transition-delay:0.15s"><span class="num glow-purple">256 MB</span><span class="label">Max Output Size</span></div>
    <div class="stat-card" style="transition-delay:0.2s"><span class="num glow-orange">30s</span><span class="label">Time Budget</span></div>
  </div>
  <div class="split mt-2" style="max-width:1200px;width:100%">
    <div>
      <h3 style="color:var(--red);margin-bottom:10px">AMSI Shallow Mode</h3>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
        <div class="stat-card" style="transition-delay:0.25s;border:1px solid rgba(255,82,82,0.3)"><span class="num" style="color:var(--red)">1</span><span class="label">Max Depth</span></div>
        <div class="stat-card" style="transition-delay:0.3s;border:1px solid rgba(255,82,82,0.3)"><span class="num" style="color:var(--red)">50</span><span class="label">Max Items</span></div>
        <div class="stat-card" style="transition-delay:0.35s;border:1px solid rgba(255,82,82,0.3)"><span class="num" style="color:var(--red)">10 MB</span><span class="label">Max Per-Item</span></div>
      </div>
      <p class="desc mt-1" style="font-size:0.75rem"><code>amunpacker</code> @ <code>0x109C7F34</code></p>
    </div>
    <div>
      <h3 style="color:var(--red);margin-bottom:10px">Expensive Container Logging</h3>
      <div class="code-block" style="font-size:0.7rem"><span class="cmt">// When time budget exceeded:</span>
<span class="str">"Expensive container</span>
<span class="str"> (Time=%llu, Limit=%llu,</span>
<span class="str">  Type=%hs): %ls\n"</span>
  @ <span class="num">0x10A55050</span>

<span class="cmt">// ETW event name:</span>
<span class="str">"Engine.Perf.ExpensiveContainer"</span>
  @ <span class="num">0x10A54EB4</span></div>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 7: VFO System & Priority -->
<div class="slide" data-slide="7">
<div class="slide-inner">
  <h2 class="glow-green mb-1">VFO System: Child Queuing</h2>
  <p class="desc mb-2">Extracted children enter the Virtual File Object queue with priority flags</p>
  <div class="split">
    <div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="engine-bar" style="border-left-color:var(--green);transition-delay:0.1s">
          <span class="name" style="color:var(--green)">vfo_add_buffer</span>
          <span class="detail mono">@ 0x1097EC78 &mdash; Add memory buffer as VFO</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--green);transition-delay:0.15s">
          <span class="name" style="color:var(--green)">vfo_add_filechunk</span>
          <span class="detail mono">@ 0x1097EC88 &mdash; Add file region as VFO</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--cyan);transition-delay:0.2s">
          <span class="name" style="color:var(--cyan)">ADD_VFO_PEPACKED</span>
          <span class="detail mono">@ 0x1097FB1C &mdash; Child is PE-packed</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--cyan);transition-delay:0.25s">
          <span class="name" style="color:var(--cyan)">ADD_VFO_VOLATILE</span>
          <span class="detail mono">@ 0x1097FB30 &mdash; Data is temporary</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--purple);transition-delay:0.3s">
          <span class="name" style="color:var(--purple)">ADD_VFO_LOW_PRIORITY</span>
          <span class="detail mono">@ 0x1097FB44 &mdash; Scan at low priority</span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--orange);transition-delay:0.35s">
          <span class="name" style="color:var(--orange)">ADD_VFO_TAKE_ACTION</span>
          <span class="detail mono">@ 0x1097FB00 &mdash; Act on parent if child detects</span>
        </div>
      </div>
    </div>
    <div>
      <h3 style="color:var(--green);margin-bottom:12px">Priority Queues</h3>
      <div style="display:flex;flex-direction:column;gap:10px">
        <div class="flow-node" style="background:rgba(57,255,20,0.15);border:2px solid rgba(57,255,20,0.4);padding:12px;transition-delay:0.1s;text-align:left">
          <strong style="color:var(--green)">svfohigh</strong> @ <span class="mono" style="font-size:0.75rem">0x109C7EE4</span><br>
          <span style="font-size:0.75rem;color:var(--fg2)">Executables, scripts, macro code</span>
        </div>
        <div style="text-align:center;color:var(--fg3)">&darr; scanned first</div>
        <div class="flow-node" style="background:rgba(255,145,0,0.1);border:1px solid rgba(255,145,0,0.3);padding:12px;transition-delay:0.2s;text-align:left">
          <strong style="color:var(--orange)">svfolow</strong> @ <span class="mono" style="font-size:0.75rem">0x109C7EE4</span><br>
          <span style="font-size:0.75rem;color:var(--fg2)">Data files, images, fonts</span>
        </div>
      </div>
      <div class="stat-card mt-2" style="transition-delay:0.3s;border:1px solid rgba(0,229,255,0.3)">
        <span class="num" style="font-size:0.9rem;color:var(--cyan)">NID_CONTINUE_CONTAINER_SCAN_AFTER_DETECTION</span>
        <span class="label">@ 0x10980FD8 &mdash; Continue scanning remaining children after a detection</span>
      </div>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 8: RTTI Class Hierarchy -->
<div class="slide" data-slide="8">
<div class="slide-inner">
  <h2 class="glow-purple mb-1">RTTI Class Hierarchy</h2>
  <p class="desc mb-2">Container classes discovered via RTTI strings in the .data section</p>
  <div class="split">
    <div class="code-block" style="font-size:0.72rem"><span class="fn">IL_container</span>
  <span class="cmt">.?AVIL_container@@</span> @ <span class="num">0x10C7A778</span>
  |
  +-- <span class="fn">lzstreamRAR</span>
  |     <span class="cmt">.?AVlzstreamRAR@@</span> @ <span class="num">0x10C79BAC</span>
  |     +-- <span class="fn">bitstreamRAR</span> @ <span class="num">0x10C7B008</span>
  |     +-- <span class="fn">UnpackFilter</span>  @ <span class="num">0x10C7D9C0</span>
  |
  +-- <span class="fn">RAR5::FileHeader</span>  @ <span class="num">0x10C85B40</span>
  |     +-- <span class="fn">RAR5::CryptHeader</span> @ <span class="num">0x10C85B20</span>
  |
  +-- <span class="fn">XZ helpers</span>
  |     +-- <span class="fn">Canceler</span>       @ <span class="num">0x10C91AD0</span>
  |     +-- <span class="fn">VfoWrapper</span>     @ <span class="num">0x10C91D50</span>
  |     +-- <span class="fn">XZReader</span>       @ <span class="num">0x10C91DB0</span>
  |
  +-- <span class="fn">nUFSP_replayablecontainer</span>
        <span class="cmt">.?AVnUFSP_replayablecontainer@@</span>
        @ <span class="num">0x10C855F4</span></div>
    <div>
      <h3 style="color:var(--purple);margin-bottom:12px">Key Design Patterns</h3>
      <div style="display:flex;flex-direction:column;gap:10px">
        <div class="stat-card" style="transition-delay:0.1s;text-align:left;padding:14px">
          <span class="label" style="color:var(--purple);font-weight:700">Polymorphic Dispatch</span>
          <span style="display:block;font-size:0.75rem;color:var(--fg2);margin-top:4px">IL_container vtable provides Open/Close/HasNext/ExtractNext interface for all 70 format handlers</span>
        </div>
        <div class="stat-card" style="transition-delay:0.15s;text-align:left;padding:14px">
          <span class="label" style="color:var(--purple);font-weight:700">Boost PMR Allocator</span>
          <span style="display:block;font-size:0.75rem;color:var(--fg2);margin-top:4px"><code>boost::container::pmr::memory_resource</code> @ <code>0x10C80114</code> for efficient memory management</span>
        </div>
        <div class="stat-card" style="transition-delay:0.2s;text-align:left;padding:14px">
          <span class="label" style="color:var(--purple);font-weight:700">Trust Validation</span>
          <span style="display:block;font-size:0.75rem;color:var(--fg2);margin-top:4px"><code>ValidateTrustPluginCAB</code> @ <code>0x10C896EC</code> allows signed CABs to bypass deep extraction</span>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 9: Installer & AI/ML Formats -->
<div class="slide" data-slide="9">
<div class="slide-inner">
  <h2 class="glow-yellow mb-1">Installers &amp; AI/ML Models</h2>
  <p class="desc mb-2">Specialized handlers for installer frameworks and emerging AI model formats</p>
  <div class="split">
    <div>
      <h3 style="color:var(--yellow)">Installer Frameworks</h3>
      <div style="display:flex;flex-direction:column;gap:6px;margin-top:8px">
        <div class="engine-bar" style="border-left-color:var(--yellow);transition-delay:0.1s">
          <span class="name" style="color:var(--yellow)">NSIS</span>
          <span class="detail"><code>nUFS_nsis</code> @ <code>0x10A14E40</code> + <code>nUFS_nsv1</code> @ <code>0x10A14EEC</code></span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--yellow);transition-delay:0.15s">
          <span class="name" style="color:var(--yellow)">Inno Setup</span>
          <span class="detail"><code>nUFS_inno</code> @ <code>0x10A151C4</code></span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--yellow);transition-delay:0.2s">
          <span class="name" style="color:var(--yellow)">InstallShield</span>
          <span class="detail"><code>nUFS_ishld</code> + <code>nUFS_ishldnew</code> @ <code>0x10A14D4C</code></span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--yellow);transition-delay:0.25s">
          <span class="name" style="color:var(--yellow)">AutoIT</span>
          <span class="detail"><code>nUFS_AutoIT</code> @ <code>0x10A14BB4</code></span>
        </div>
        <div class="engine-bar" style="border-left-color:var(--yellow);transition-delay:0.3s">
          <span class="name" style="color:var(--yellow)">Wise / SFX</span>
          <span class="detail"><code>nUFS_wise</code> @ <code>0x10A15354</code> &bull; <code>(CABSfx)</code> @ <code>0x1097EB78</code></span>
        </div>
      </div>
    </div>
    <div>
      <h3 style="color:var(--yellow)">AI/ML Model Scanning</h3>
      <div style="display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px">
        <div class="stat-card" style="transition-delay:0.1s;text-align:left;padding:14px;border-left:3px solid var(--yellow)">
          <span class="num" style="font-size:1rem;color:var(--yellow)">nUFS_onnx</span>
          <span class="label">@ 0x10A3AC90 &mdash; Open Neural Network Exchange models</span>
        </div>
        <div class="stat-card" style="transition-delay:0.15s;text-align:left;padding:14px;border-left:3px solid var(--yellow)">
          <span class="num" style="font-size:1rem;color:var(--yellow)">nUFS_gguf</span>
          <span class="label">@ 0x10A3ACE4 &mdash; GGUF format (llama.cpp LLM models)</span>
        </div>
        <div class="stat-card" style="transition-delay:0.2s;text-align:left;padding:14px;border-left:3px solid var(--red)">
          <span class="num" style="font-size:1rem;color:var(--red)">nUFS_pickle</span>
          <span class="label">@ 0x10A3B04C &mdash; Python pickle (arbitrary code execution risk)</span>
        </div>
      </div>
      <p class="desc mt-2" style="font-size:0.8rem">These handlers indicate parser coverage for model-related formats; exact detection depth depends on loaded signatures and cloud intelligence.</p>
    </div>
  </div>
</div>
</div>

<!-- SLIDE 10: Attributes & Cross-References -->
<div class="slide" data-slide="10">
<div class="slide-inner center-col">
  <h2 class="glow-cyan mb-1">Attributes &amp; Cross-References</h2>
  <p class="desc mb-2">Container attributes flow into all downstream pipeline stages</p>
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;width:100%;max-width:1200px">
    <div class="stat-card" style="transition-delay:0.1s;text-align:left;padding:16px;border-top:3px solid var(--cyan)">
      <h3 style="color:var(--cyan);font-size:0.9rem;margin-bottom:8px">Container Attributes</h3>
      <div class="code-block" style="font-size:0.65rem;padding:10px"><span class="str">"containertype"</span>   <span class="num">0x109E7CA8</span>
<span class="str">"iscontainer"</span>     <span class="num">0x109E7EA0</span>
<span class="str">"isincontainer"</span>   <span class="num">0x109E7EBC</span>
<span class="str">"containerfile"</span>   <span class="num">0x109D729C</span>
<span class="str">"isappcontainer"</span>  <span class="num">0x109855D8</span>
<span class="str">"isincontaineros"</span> <span class="num">0x109C96C0</span></div>
    </div>
    <div class="stat-card" style="transition-delay:0.15s;text-align:left;padding:16px;border-top:3px solid var(--green)">
      <h3 style="color:var(--green);font-size:0.9rem;margin-bottom:8px">Flows Into (Downstream)</h3>
      <div style="font-size:0.75rem;color:var(--fg2);line-height:2">
        <div><strong style="color:var(--green)">Stage 8</strong> &mdash; NScript (VBA/JS from OLE2/PDF)</div>
        <div><strong style="color:var(--green)">Stage 9</strong> &mdash; BRUTE (BRUTE:PDF:Feature:)</div>
        <div><strong style="color:var(--green)">Stage 10</strong> &mdash; Lua scripts</div>
        <div><strong style="color:var(--green)">Stage 11</strong> &mdash; AAGG aggregation</div>
        <div><strong style="color:var(--green)">Stage 3</strong> &mdash; Static cascade (recursive)</div>
      </div>
    </div>
    <div class="stat-card" style="transition-delay:0.2s;text-align:left;padding:16px;border-top:3px solid var(--purple)">
      <h3 style="color:var(--purple);font-size:0.9rem;margin-bottom:8px">Receives From (Upstream)</h3>
      <div style="font-size:0.75rem;color:var(--fg2);line-height:2">
        <div><strong style="color:var(--purple)">Stage 6</strong> &mdash; Unpacked PE content</div>
        <div><strong style="color:var(--purple)">Stage 3</strong> &mdash; containertype attribute</div>
        <div><strong style="color:var(--purple)">Stage 4</strong> &mdash; File type metadata</div>
        <div><strong style="color:var(--purple)">DBVAR</strong> &mdash; Depth/item/size limits</div>
        <div><strong style="color:var(--purple)">AMSI</strong> &mdash; Shallow mode config</div>
      </div>
    </div>
  </div>
  <div class="stat-card mt-2" style="transition-delay:0.3s;border:2px solid rgba(0,229,255,0.4);max-width:800px">
    <span class="num glow-cyan" style="font-size:1.1rem">Stage 7 &rarr; Stage 2 (Recursive Full Pipeline)</span>
    <span class="label">Each extracted child enters the pipeline at Stage 2 with scan_depth + 1</span>
  </div>
</div>
</div>

<!-- SLIDE 11: Summary -->
<div class="slide" data-slide="11">
<div class="slide-inner center-col" style="justify-content:center">
  <h2 class="glow-cyan mb-2">Container Extraction: Summary</h2>
  <div class="stat-grid stat-grid-4" style="width:100%;max-width:1200px">
    <div class="stat-card" style="transition-delay:0.05s"><span class="num glow-cyan" data-count="70">0</span><span class="label">nUFS Format Handlers</span></div>
    <div class="stat-card" style="transition-delay:0.1s"><span class="num glow-green">25+</span><span class="label">Archive Formats</span></div>
    <div class="stat-card" style="transition-delay:0.15s"><span class="num glow-purple">15</span><span class="label">PDF Config Flags</span></div>
    <div class="stat-card" style="transition-delay:0.2s"><span class="num glow-orange">3</span><span class="label">AI/ML Model Parsers</span></div>
    <div class="stat-card" style="transition-delay:0.25s"><span class="num glow-cyan">10</span><span class="label">Installer Handlers</span></div>
    <div class="stat-card" style="transition-delay:0.3s"><span class="num glow-green">7</span><span class="label">Email Formats</span></div>
    <div class="stat-card" style="transition-delay:0.35s"><span class="num glow-purple">7</span><span class="label">Disk Image Formats</span></div>
    <div class="stat-card" style="transition-delay:0.4s"><span class="num glow-orange">16</span><span class="label">Max Nesting Depth</span></div>
  </div>
  <p class="mt-3 desc" style="max-width:800px">Container extraction is the recursive heart of the Defender pipeline. It peers inside archives, documents, installers, disk images, and AI model files to find threats hidden within nested structures. Each child is scanned through the <strong>stages 2-13 (post-dispatch scan path)</strong>.</p>
  <p class="mono mt-2" style="font-size:0.75rem;color:var(--fg3)">IL_container RTTI @ 0x10C7A778 &bull; containertype @ 0x109E7CA8 &bull; 70 nUFS_* handlers &bull; mpengine.dll</p>
</div>
</div>

</div><!-- /deck -->

<script>
(function(){
  const slides = document.querySelectorAll('.slide');
  const total = slides.length;
  let current = 0;
  const progress = document.getElementById('progress');
  const counter = document.getElementById('slide-counter');
  function parseHash(){const h=parseInt(location.hash.replace('#',''),10);if(h>=1&&h<=total)return h-1;return 0;}
  function goTo(n,skipHash){
    if(n<0||n>=total||n===current)return;
    slides[current].classList.remove('active');
    slides[current].classList.add(n>current?'prev':'');
    const old=slides[current];setTimeout(()=>old.classList.remove('prev'),600);
    current=n;slides[current].classList.add('active');
    progress.style.width=((current+1)/total*100)+'%';
    counter.textContent=(current+1)+' / '+total;
    if(!skipHash)location.hash='#'+(current+1);
    animateCounters(slides[current]);
  }
  function next(){goTo(current+1);}
  function prev(){goTo(current-1);}
  document.addEventListener('keydown',function(e){
    if(e.key==='ArrowRight'||e.key===' '||e.key==='PageDown'){e.preventDefault();next();}
    else if(e.key==='ArrowLeft'||e.key==='PageUp'){e.preventDefault();prev();}
    else if(e.key==='Home'){e.preventDefault();goTo(0);}
    else if(e.key==='End'){e.preventDefault();goTo(total-1);}
  });
  document.getElementById('deck').addEventListener('click',function(e){
    if(e.clientX<window.innerWidth*0.35)prev();
    else if(e.clientX>window.innerWidth*0.65)next();
  });
  let touchStartX=0;
  document.addEventListener('touchstart',function(e){touchStartX=e.changedTouches[0].clientX;},{passive:true});
  document.addEventListener('touchend',function(e){const dx=e.changedTouches[0].clientX-touchStartX;if(Math.abs(dx)>50){if(dx<0)next();else prev();}},{passive:true});
  window.addEventListener('hashchange',function(){goTo(parseHash(),true);});
  function animateCounters(el){
    el.querySelectorAll('[data-count]').forEach(function(n){
      const target=parseInt(n.getAttribute('data-count'),10);if(isNaN(target))return;
      const start=performance.now();
      function tick(now){const t=Math.min((now-start)/1200,1);const eased=1-Math.pow(1-t,3);
        n.textContent=Math.round(target*eased).toLocaleString();if(t<1)requestAnimationFrame(tick);}
      requestAnimationFrame(tick);
    });
  }
  const startSlide=parseHash();if(startSlide!==0)slides[0].classList.remove('active');
  current=startSlide;slides[current].classList.add('active');
  progress.style.width=((current+1)/total*100)+'%';
  counter.textContent=(current+1)+' / '+total;
  setTimeout(function(){animateCounters(slides[current]);},300);
})();
</script>
<script src="deck_master_nav.js"></script>
</body>
</html>
